{"ast":null,"code":"import API from '../../API';\nimport { increaseCartAction, decreaseCartAction, fetchCartAction, addCartAction } from './actions';\nconst api = new API();\nconst CARTS_KEY = \"CARTS_KEY\";\nexport const fetchFromLocalStorage = () => {\n  return async dispatch => {\n    let cartsJSON = localStorage.getItem(CARTS_KEY);\n    let carts = {};\n\n    if (cartsJSON) {\n      carts = JSON.parse(cartsJSON);\n    }\n\n    const subtotal = calculateSubtotal(carts);\n    dispatch(fetchCartAction(carts, subtotal));\n  };\n};\nexport const addCart = item => {\n  return async (dispatch, getState) => {\n    let prevCarts = getState().carts.list;\n    prevCarts[item.id] = {\n      'item': item,\n      selected_count: 1\n    };\n    const subtotal = calculateSubtotal(prevCarts);\n    setToLocalStorage(prevCarts);\n    dispatch(addCartAction(prevCarts, subtotal));\n  };\n};\nexport const increaseCart = item => {\n  return async (dispatch, getState) => {\n    let prevCarts = getState().carts.list;\n    let nextSelectedCount = prevCarts[item.id].selected_count + 1;\n    prevCarts[item.id] = {\n      item: item,\n      selected_count: nextSelectedCount\n    };\n    const subtotal = calculateSubtotal(prevCarts);\n    setToLocalStorage(prevCarts);\n    dispatch(increaseCartAction(prevCarts, subtotal));\n  };\n};\nexport const decreaseCart = item => {\n  return async (dispatch, getState) => {\n    let prevCarts = getState().carts.list;\n    let nextSelectedCount = prevCarts[item.id].selected_count - 1;\n\n    if (nextSelectedCount > 0) {\n      prevCarts[item.id] = {\n        item: item,\n        selected_count: nextSelectedCount\n      };\n    } else {\n      delete prevCarts[item.id];\n    }\n\n    const subtotal = calculateSubtotal(prevCarts);\n    setToLocalStorage(prevCarts);\n    dispatch(decreaseCartAction(prevCarts, subtotal));\n  };\n};\n\nconst setToLocalStorage = carts => {\n  localStorage.setItem(CARTS_KEY, JSON.stringify(carts));\n};\n\nconst calculateSubtotal = carts => {\n  let subtotal = 0;\n  console.log(carts);\n\n  for (let key in carts) {\n    subtotal += Number(carts[key].item.price) * carts[key].selected_count;\n  }\n\n  return subtotal;\n};","map":{"version":3,"names":["API","increaseCartAction","decreaseCartAction","fetchCartAction","addCartAction","api","CARTS_KEY","fetchFromLocalStorage","dispatch","cartsJSON","localStorage","getItem","carts","JSON","parse","subtotal","calculateSubtotal","addCart","item","getState","prevCarts","list","id","selected_count","setToLocalStorage","increaseCart","nextSelectedCount","decreaseCart","setItem","stringify","console","log","key","Number","price"],"sources":["/Users/musubimanagement/Documents/WEB/SD_Hunger_Captian/techis-wd-forum-django-react/frontend/src/reducks/carts/operations.js"],"sourcesContent":["import API from '../../API';\nimport {increaseCartAction ,\ndecreaseCartAction,fetchCartAction, addCartAction} from './actions';\n\nconst api = new API();\nconst CARTS_KEY=\"CARTS_KEY\";\n\nexport const fetchFromLocalStorage=()=>{\n    return async(dispatch) =>{\n        let cartsJSON=localStorage.getItem(CARTS_KEY);\n        let carts={};\n        if (cartsJSON){\n            carts=JSON.parse(cartsJSON);\n        }\n        const subtotal=calculateSubtotal(carts);\n        dispatch(fetchCartAction(carts,subtotal));\n    };\n};\n\nexport const addCart=(item) =>{\n    return async(dispatch,getState)=>{\n        let prevCarts=getState().carts.list;\n        prevCarts[item.id]={'item':item,selected_count:1};\n        const subtotal=calculateSubtotal(prevCarts);\n        setToLocalStorage(prevCarts);\n        dispatch(addCartAction(prevCarts,subtotal));\n    };\n};\n\n\nexport const increaseCart =(item)=>{\n    return async(dispatch,getState)=>{\n        let prevCarts=getState().carts.list;\n        let nextSelectedCount=prevCarts[item.id].selected_count+1;\n        prevCarts[item.id]={item: item,selected_count:nextSelectedCount};\n        const subtotal=calculateSubtotal(prevCarts);\n        setToLocalStorage(prevCarts);\n        dispatch(increaseCartAction(prevCarts,subtotal));\n\n    }\n}\n\nexport const decreaseCart =(item)=>{\n    return async(dispatch,getState)=>{\n        let prevCarts=getState().carts.list;\n        let nextSelectedCount=prevCarts[item.id].selected_count-1;\n        if (nextSelectedCount>0){\n            prevCarts[item.id]={item:item,selected_count:nextSelectedCount};\n        }else{\n            delete prevCarts[item.id];\n        }\n        const subtotal=calculateSubtotal(prevCarts);\n        setToLocalStorage(prevCarts);\n        dispatch(decreaseCartAction(prevCarts,subtotal));\n    }\n}\nconst setToLocalStorage = (carts) => {\n    localStorage.setItem(CARTS_KEY, JSON.stringify(carts));\n  };\n  \n  const calculateSubtotal = (carts) => {\n    let subtotal = 0;\n    console.log(carts);\n    for (let key in carts) {\n      subtotal += Number(carts[key].item.price) * carts[key].selected_count;\n    }\n    return subtotal;\n  };"],"mappings":"AAAA,OAAOA,GAAP,MAAgB,WAAhB;AACA,SAAQC,kBAAR,EACAC,kBADA,EACmBC,eADnB,EACoCC,aADpC,QACwD,WADxD;AAGA,MAAMC,GAAG,GAAG,IAAIL,GAAJ,EAAZ;AACA,MAAMM,SAAS,GAAC,WAAhB;AAEA,OAAO,MAAMC,qBAAqB,GAAC,MAAI;EACnC,OAAO,MAAMC,QAAN,IAAkB;IACrB,IAAIC,SAAS,GAACC,YAAY,CAACC,OAAb,CAAqBL,SAArB,CAAd;IACA,IAAIM,KAAK,GAAC,EAAV;;IACA,IAAIH,SAAJ,EAAc;MACVG,KAAK,GAACC,IAAI,CAACC,KAAL,CAAWL,SAAX,CAAN;IACH;;IACD,MAAMM,QAAQ,GAACC,iBAAiB,CAACJ,KAAD,CAAhC;IACAJ,QAAQ,CAACL,eAAe,CAACS,KAAD,EAAOG,QAAP,CAAhB,CAAR;EACH,CARD;AASH,CAVM;AAYP,OAAO,MAAME,OAAO,GAAEC,IAAD,IAAS;EAC1B,OAAO,OAAMV,QAAN,EAAeW,QAAf,KAA0B;IAC7B,IAAIC,SAAS,GAACD,QAAQ,GAAGP,KAAX,CAAiBS,IAA/B;IACAD,SAAS,CAACF,IAAI,CAACI,EAAN,CAAT,GAAmB;MAAC,QAAOJ,IAAR;MAAaK,cAAc,EAAC;IAA5B,CAAnB;IACA,MAAMR,QAAQ,GAACC,iBAAiB,CAACI,SAAD,CAAhC;IACAI,iBAAiB,CAACJ,SAAD,CAAjB;IACAZ,QAAQ,CAACJ,aAAa,CAACgB,SAAD,EAAWL,QAAX,CAAd,CAAR;EACH,CAND;AAOH,CARM;AAWP,OAAO,MAAMU,YAAY,GAAGP,IAAD,IAAQ;EAC/B,OAAO,OAAMV,QAAN,EAAeW,QAAf,KAA0B;IAC7B,IAAIC,SAAS,GAACD,QAAQ,GAAGP,KAAX,CAAiBS,IAA/B;IACA,IAAIK,iBAAiB,GAACN,SAAS,CAACF,IAAI,CAACI,EAAN,CAAT,CAAmBC,cAAnB,GAAkC,CAAxD;IACAH,SAAS,CAACF,IAAI,CAACI,EAAN,CAAT,GAAmB;MAACJ,IAAI,EAAEA,IAAP;MAAYK,cAAc,EAACG;IAA3B,CAAnB;IACA,MAAMX,QAAQ,GAACC,iBAAiB,CAACI,SAAD,CAAhC;IACAI,iBAAiB,CAACJ,SAAD,CAAjB;IACAZ,QAAQ,CAACP,kBAAkB,CAACmB,SAAD,EAAWL,QAAX,CAAnB,CAAR;EAEH,CARD;AASH,CAVM;AAYP,OAAO,MAAMY,YAAY,GAAGT,IAAD,IAAQ;EAC/B,OAAO,OAAMV,QAAN,EAAeW,QAAf,KAA0B;IAC7B,IAAIC,SAAS,GAACD,QAAQ,GAAGP,KAAX,CAAiBS,IAA/B;IACA,IAAIK,iBAAiB,GAACN,SAAS,CAACF,IAAI,CAACI,EAAN,CAAT,CAAmBC,cAAnB,GAAkC,CAAxD;;IACA,IAAIG,iBAAiB,GAAC,CAAtB,EAAwB;MACpBN,SAAS,CAACF,IAAI,CAACI,EAAN,CAAT,GAAmB;QAACJ,IAAI,EAACA,IAAN;QAAWK,cAAc,EAACG;MAA1B,CAAnB;IACH,CAFD,MAEK;MACD,OAAON,SAAS,CAACF,IAAI,CAACI,EAAN,CAAhB;IACH;;IACD,MAAMP,QAAQ,GAACC,iBAAiB,CAACI,SAAD,CAAhC;IACAI,iBAAiB,CAACJ,SAAD,CAAjB;IACAZ,QAAQ,CAACN,kBAAkB,CAACkB,SAAD,EAAWL,QAAX,CAAnB,CAAR;EACH,CAXD;AAYH,CAbM;;AAcP,MAAMS,iBAAiB,GAAIZ,KAAD,IAAW;EACjCF,YAAY,CAACkB,OAAb,CAAqBtB,SAArB,EAAgCO,IAAI,CAACgB,SAAL,CAAejB,KAAf,CAAhC;AACD,CAFH;;AAIE,MAAMI,iBAAiB,GAAIJ,KAAD,IAAW;EACnC,IAAIG,QAAQ,GAAG,CAAf;EACAe,OAAO,CAACC,GAAR,CAAYnB,KAAZ;;EACA,KAAK,IAAIoB,GAAT,IAAgBpB,KAAhB,EAAuB;IACrBG,QAAQ,IAAIkB,MAAM,CAACrB,KAAK,CAACoB,GAAD,CAAL,CAAWd,IAAX,CAAgBgB,KAAjB,CAAN,GAAgCtB,KAAK,CAACoB,GAAD,CAAL,CAAWT,cAAvD;EACD;;EACD,OAAOR,QAAP;AACD,CAPD"},"metadata":{},"sourceType":"module"}